generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model appointments {
  id           String   @id @db.Uuid
  doctor_id    String   @db.Uuid
  patient_id   String   @db.Uuid
  service_name String
  starts_at    DateTime @db.Timestamptz(6)
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  updated_at   DateTime @default(now()) @db.Timestamptz(6)
  doctors      doctors  @relation(fields: [doctor_id], references: [doctor_id], onDelete: NoAction, onUpdate: NoAction)
  patients     patients @relation(fields: [patient_id], references: [patient_id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([doctor_id, starts_at])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This table contains exclusion constraints and requires additional setup for migrations. Visit https://pris.ly/d/exclusion-constraints for more info.
model doctor_weekly_slots {
  id         String                 @id @db.Uuid
  doctor_id  String                 @db.Uuid
  weekday    Int                    @db.SmallInt
  time_range Unsupported("tsrange")
  doctors    doctors                @relation(fields: [doctor_id], references: [doctor_id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([doctor_id, weekday, time_range])
}

model doctors {
  doctor_id           String                @id @db.Uuid
  specialization      String
  appointments        appointments[]
  doctor_weekly_slots doctor_weekly_slots[]
  users               users                 @relation(fields: [doctor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "doctors_user_id_fkey")
}

model patients {
  patient_id   String         @id(map: "patients_pk") @db.Uuid
  phone        String
  appointments appointments[]
  users        users          @relation(fields: [patient_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model user_auth {
  user_id      String  @id @db.Uuid
  email        String  @unique
  password     String
  refreshtoken String?
  users        users   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id         String     @id(map: "users_pk") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  first_name String     @db.VarChar(50)
  last_name  String     @db.VarChar(50)
  role       user_role  @default(patient)
  created_at DateTime   @default(now()) @db.Timestamptz(6)
  updated_at DateTime   @default(now()) @db.Timestamptz(6)
  doctors    doctors?
  patients   patients?
  user_auth  user_auth?
}

enum user_role {
  admin
  doctor
  patient
}
