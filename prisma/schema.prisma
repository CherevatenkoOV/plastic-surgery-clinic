generator client {
  provider        = "prisma-client"
  previewFeatures = ["typedSql"]
  output          = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Appointment {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doctorId    String   @map("doctor_id") @db.Uuid
  patientId   String   @map("patient_id") @db.Uuid
  serviceName String   @map("service_name")
  startsAt    DateTime @map("starts_at") @db.Timestamptz(6)
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  doctor      Doctor   @relation(fields: [doctorId], references: [doctorId], onDelete: NoAction, onUpdate: NoAction)
  patient     Patient  @relation(fields: [patientId], references: [patientId], onDelete: NoAction, onUpdate: NoAction)

  @@unique([doctorId, startsAt])
  @@map("appointments")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This table contains exclusion constraints and requires additional setup for migrations. Visit https://pris.ly/d/exclusion-constraints for more info.
model DoctorWeeklySlot {
  id        String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doctorId  String                 @map("doctor_id") @db.Uuid
  weekday   Int                    @db.SmallInt
  timeRange Unsupported("tsrange") @map("time_range")
  doctor    Doctor                 @relation(fields: [doctorId], references: [doctorId], onDelete: Cascade, onUpdate: NoAction)

  @@unique([doctorId, weekday, timeRange])
  @@map("doctor_weekly_slots")
}

model Doctor {
  doctorId          String             @id @default(dbgenerated("gen_random_uuid()")) @map("doctor_id") @db.Uuid
  specialization    String
  appointments      Appointment[]
  doctorWeeklySlots DoctorWeeklySlot[]
  user              User               @relation(fields: [doctorId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "doctors_user_id_fkey")

  @@map("doctors")
}

model Patient {
  patientId    String        @id(map: "patients_pk") @default(dbgenerated("gen_random_uuid()")) @map("patient_id") @db.Uuid
  phone        String
  appointments Appointment[]
  user         User          @relation(fields: [patientId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("patients")
}

model UserAuth {
  userId       String  @id @map("user_id") @db.Uuid
  email        String  @unique
  passwordHash String  @map("password_hash")
  refreshToken String? @map("refresh_token")
  user         User    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("user_auth")
}

model User {
  id        String    @id(map: "users_pk") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  firstName String    @map("first_name") @db.VarChar(50)
  lastName  String    @map("last_name") @db.VarChar(50)
  role      UserRole  @default(patient)
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  doctor    Doctor?
  patient   Patient?
  userAuth  UserAuth?

  @@map("users")
}

enum UserRole {
  admin
  doctor
  patient

  @@map("user_role")
}
